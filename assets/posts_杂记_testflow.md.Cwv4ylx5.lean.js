import{_ as a,c as e,a2 as t,o as p}from"./chunks/framework.D_NaTb9t.js";const u=JSON.parse('{"title":"记一次阿里code-flow(云效)git pull出现的问题","description":"","frontmatter":{"title":"记一次阿里code-flow(云效)git pull出现的问题","hidemeta":true},"headers":[],"relativePath":"posts/杂记/testflow.md","filePath":"posts/杂记/testflow.md"}'),n={name:"posts/杂记/testflow.md"};function l(o,s,i,r,c,h){return p(),e("div",null,s[0]||(s[0]=[t(`<h1 id="记一次阿里code-flow-云效-git-pull出现的问题" tabindex="-1">记一次阿里code-flow(云效)git pull出现的问题 <a class="header-anchor" href="#记一次阿里code-flow-云效-git-pull出现的问题" aria-label="Permalink to &quot;记一次阿里code-flow(云效)git pull出现的问题&quot;">​</a></h1><p>git pull 本地可以 但是通过阿里flow 不可以</p><h2 id="git-pull-提示如下" tabindex="-1">git pull 提示如下: <a class="header-anchor" href="#git-pull-提示如下" aria-label="Permalink to &quot;git pull 提示如下:&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Permission denied (publickey).</span></span>
<span class="line"><span>fatal: Could not read from remote repository.</span></span>
<span class="line"><span>Please make sure you have the correct access rights</span></span>
<span class="line"><span>and the repository exists.</span></span></code></pre></div><h2 id="原因分析" tabindex="-1">原因分析 <a class="header-anchor" href="#原因分析" aria-label="Permalink to &quot;原因分析&quot;">​</a></h2><ul><li>使用的是ssh, 而非https 对git 进行管理</li><li>本地的id_rsa_pub 已经添加到阿里云</li><li>id_rsa 是包含密码的</li><li>服务器通过 ssh-add(ssh-agent) 实现免ssh的 passphrase 输入</li></ul><h2 id="是没有输入ssh的-passphrase-原因" tabindex="-1">是没有输入ssh的 passphrase 原因 <a class="header-anchor" href="#是没有输入ssh的-passphrase-原因" aria-label="Permalink to &quot;是没有输入ssh的 passphrase 原因&quot;">​</a></h2><p>因为ssh-agent 在某些情况下并不会启动, 导致还是要输入passphrase, 在没有输入的情况下会报错</p><h2 id="解决方案1-输入passphrase" tabindex="-1">解决方案1, 输入passphrase: <a class="header-anchor" href="#解决方案1-输入passphrase" aria-label="Permalink to &quot;解决方案1, 输入passphrase:&quot;">​</a></h2><p><a href="https://stackoverflow.com/questions/34155308/provide-passphrase-to-git-in-bash-script" target="_blank" rel="noreferrer">参考</a> 修改脚本如下:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd /root/hugo/para/hugo/</span></span>
<span class="line"><span>expect &lt;&lt;EOD</span></span>
<span class="line"><span>spawn git pull </span></span>
<span class="line"><span>expect &quot;Enter passphrase for key &#39;/root/.ssh/id_rsa&#39;: &quot;</span></span>
<span class="line"><span>send &quot;passphrase\\r&quot;</span></span>
<span class="line"><span>expect eof</span></span>
<span class="line"><span>EOD</span></span>
<span class="line"><span>/root/hugo/hugo</span></span></code></pre></div><p>要先安装 expect</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>yum -y install expect</span></span></code></pre></div><h2 id="解决方案2-使用https-代替-ssh-输入密码" tabindex="-1">解决方案2, 使用https 代替 ssh, 输入密码: <a class="header-anchor" href="#解决方案2-使用https-代替-ssh-输入密码" aria-label="Permalink to &quot;解决方案2, 使用https 代替 ssh, 输入密码:&quot;">​</a></h2><h3 id="使用-expect-参考上面可以" tabindex="-1">使用 expect 参考上面可以: <a class="header-anchor" href="#使用-expect-参考上面可以" aria-label="Permalink to &quot;使用 expect 参考上面可以:&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CONID=&#39;Your git account&#39; </span></span>
<span class="line"><span>CONKEY=&#39;Your git password&#39; </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>cd /home/wwwroot/default/project</span></span>
<span class="line"><span>expect -c &quot;spawn git pull origin; expect \\&quot;*Username*\\&quot; { send \\&quot;\${CONID}\\n\\&quot;; exp_continue } \\&quot;*Password*\\&quot; { send \\&quot;\${CONKEY}\\n\\&quot; }; interact&quot;</span></span></code></pre></div><h3 id="使用url" tabindex="-1">使用url <a class="header-anchor" href="#使用url" aria-label="Permalink to &quot;使用url&quot;">​</a></h3><p><a href="https://stackoverflow.com/questions/14629107/how-to-input-password-to-git-pull-command" target="_blank" rel="noreferrer">参考</a></p><p><strong>Synopsis:</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>git pull &quot;https://&lt;username&gt;:&lt;password&gt;@github.com/&lt;github_account&gt;/&lt;repository_name&gt;.git&quot; &lt;branch_name&gt;</span></span></code></pre></div><p><strong>Example:</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>git pull &quot;https://admin:12345@github.com/Jet/myProject.git&quot; master</span></span></code></pre></div>`,22)]))}const g=a(n,[["render",l]]);export{u as __pageData,g as default};
